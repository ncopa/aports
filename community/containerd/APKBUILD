# Maintainer: Bernhard J. M. Gruen <bernhard.gruen@googlemail.com>
pkgname=containerd
pkgver=1.2.0
pkgrel=0
_commit=c4446665cb9c30056f4998ed953e6d4ff22c7c39
pkgdesc="An open and reliable container runtime"
url="https://containerd.io/"
arch="all"
license="Apache-2.0"
depends="runc"
makedepends="go linux-headers btrfs-progs-dev protobuf-dev"
source="containerd-$pkgver.tar.gz::https://github.com/containerd/containerd/archive/v$pkgver.tar.gz
	"

builddir="$srcdir"/containerd-$pkgver

prepare() {
	cd "$builddir"
	mkdir src
	mv vendor/* src
	ln -s "$builddir" src/github.com/containerd/containerd
}

build() {
	cd "$builddir"
	GOPATH="$PWD" LDFLAGS="" make VERSION="v$pkgver" REVISION="$_commit"
}

check() {
	cd "$builddir"
	./bin/containerd --version
}

package() {
	cd "$builddir"

	install -d "$pkgdir"/usr/bin/
	install -Dm755 "$builddir"/bin/* "$pkgdir"/usr/bin/
}

sha512sums="f7e1ede8db253c666dc9d68642951a427722945da60acf8631312377c84aab14c7a8b14e81f9a63ab8f909d25eb55911c0f2eef68f11380c66cd77bada8577bd  containerd-1.2.0.tar.gz"
